<%-
	local gluon_luci = require 'gluon.luci'
	local sysconfig = require 'gluon.sysconfig'
	local i18n = require 'luci.i18n'
	local template = require 'luci.template'
-%>

<h2><%:Welcome!%></h2>
<p>
	<%= template.render_string(i18n.translate('gluon-config-mode:welcome'), {
		hostname = hostname,
		sysconfig = sysconfig,
		escape = gluon_luci.escape,
		urlescape = gluon_luci.urlescape,
	}) %>
</p>

<% if not self.embedded then %>
<form method="post" enctype="multipart/form-data" action="<%=REQUEST_URI%>">
	<div>
		<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
		<script type="text/javascript">
var form = document.getElementsByTagName('form')[0];
function isEmpty(elem) {
	if (elem == null || elem.value == null || elem.value == "")
		return true
	return false
}
form.addEventListener('submit', function formSubmit(evt) {
	var inputcontact = document.getElementById('cbid.wizard.1._contact');
	var inputlocation = document.getElementById('cbid.wizard.1._location');
	var inputloclat = document.getElementById('cbid.wizard.1._latitude');
	var inputloclong = document.getElementById('cbid.wizard.1._longitude');
	var confirmcontact = true;
	var confirmlocation = true;
	if (isEmpty(inputcontact))
		confirmcontact = confirm("Willst Du wirklich keine Kontaktinformation hinterlegen?");
	if (isEmpty(inputlocation) || inputlocation.value == "0" || isEmpty(inputloclat) || isEmpty(inputloclong))
		confirmlocation = confirm("Willst Du wirklich keinen Standort angeben?");
	if (!confirmcontact || !confirmlocation) {
		evt.returnValue = false;
		if (evt.preventDefault) evt.preventDefault();
		return false;
	}
	return true;
}, false);
		</script>
		<input type="hidden" name="cbi.submit" value="1" />
	</div>
<% end %>
	<div class="cbi-map" id="cbi-<%=self.config%>">
		<% if self.title and #self.title > 0 then %><h2><a id="content" name="content"><%=self.title%></a></h2><% end %>
		<% if self.description and #self.description > 0 then %><div class="cbi-map-descr"><%=self.description%></div><% end %>
		<% self:render_children() %>
		<br />
	</div>
<%- if self.message then %>
	<div><%=self.message%></div>
<%- end %>
<%- if self.errmessage then %>
	<div class="error"><%=self.errmessage%></div>
<%- end %>
<% if not self.embedded then %>
	<div class="cbi-page-actions">
<%-
		if type(self.hidden) == "table" then
		  for k, v in pairs(self.hidden) do
-%>
		<input type="hidden" id="<%=k%>" name="<%=k%>" value="<%=pcdata(v)%>" />
<%-
		  end
		end
%>
		<input class="cbi-button cbi-button-save" type="submit" value="<%:Save & restart%>" />
		<script type="text/javascript">cbi_d_update();</script>
	</div>
</form>
<% end %>
